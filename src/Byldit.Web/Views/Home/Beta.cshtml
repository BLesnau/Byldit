@using Byldit.Web.Configs
@using System.Web.Helpers
@{
    ViewBag.Title = "Byldit";
}
@section header
{
    @*<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />*@
    <meta name="viewport" content="width=device-width" />
    <style type="text/css">
        html {
            height: 100%;
        }

        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map-canvas {
            height: 100%;
        }
    </style>
}

<div id="topBarContainer">
    <div class="lockedHeader">
        <img class="logoPadding" src="~/Content/Images/byldit-header-logo-combined.png" />

        <div class="float-right">
            <div id="notSignedIn" class="socialPaddingNotSignedIn">
                <div class="signInText">Sign in</div>
                <a class="socialButton" href="javascript:login(&quot;facebook&quot;)">
                    <img src="~/Content/Images/facebook-widget.jpg" /></a>
                <a class="socialButton" href="javascript:login(&quot;twitter&quot;)">
                    <img src="~/Content/Images/twitter-widget.jpg" /></a>
                <a class="socialButton" href="javascript:login(&quot;google&quot;)">
                    <img src="~/Content/Images/google-widget.jpg" /></a>

                <br />

                <label class="signInText">
                    <input id="rememberMeCheck" type="checkbox" name="rememberMe" value="value" />Remember me</label>
            </div>

            <div id="signedIn" class="socialPaddingSignedIn">
                <div>
                    <label class="signInTextBig vertMiddle">Signed in with</label>
                    <img id="fbLogo" class="providerIcon vertMiddle" src="~/Content/Images/facebook-widget.jpg" />
                    <img id="twitterLogo" class="providerIcon vertMiddle" src="~/Content/Images/twitter-widget.jpg" />
                    <img id="googleLogo" class="providerIcon vertMiddle" src="~/Content/Images/google-widget.jpg" />
                </div>
                <div class="signOutTextPadding">
                    <a class="signOutText" href="javascript:logout();">Sign out</a>
                </div>
            </div>
        </div>

    </div>
</div>

<div id="content">
    <div id="map-canvas" />
</div>

@section scripts
{
    <script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlZMdkkoh0DdR8d06ifz0JeREYVdPsmpU&sensor=true&libraries=geometry,places">
    </script>
    <script type="text/javascript" src="~/Scripts/ShowTagsButton.js">
    </script>
    <script type="text/javascript" src="~/Scripts/SearchBox.js">
    </script>
    <script type="text/javascript" src="~/Scripts/infobubble-compiled.js">
    </script>
    <@*script type="text/javascript" src="~/Scripts/infobubble.js">
    </@*script>*@
    <script type="text/javascript" src="~/Scripts/PopupHelper.js">
    </script>
    <script type="text/javascript" src="~/Scripts/geolocationmarker-compiled.js">
    </script>
    <script type="text/javascript" src="~/Scripts/gmap3/gmap3.min.js">
    </script>
    <script type="text/javascript">
        function initialize() {
            $( "#signedIn" ).hide();
            $( "#notSignedIn" ).hide();

            mobileServicesUrl = "@GlobalConfig.GetString( "AzureMobileServiceUrl" )";
            mobileServicesKey = "@GlobalConfig.GetString( "AzureMobileServiceKey" )";
            baseImagePath = "@GlobalConfig.GetString( "BaseImagePath" )";

            LoadSettings();

            var mapOptions = {
                center: new google.maps.LatLng( locLat, locLon ),
                zoom: 4,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                streetViewControl: false,
                panControl: false,
                zoomControlOptions: {
                    position: google.maps.ControlPosition.LEFT_TOP
                }
            };
            //googleMap = new google.maps.Map( document.getElementById( "map-canvas" ),
            //    mapOptions );

            $( "#map-canvas" ).gmap3( {
                map: {
                    options: mapOptions,
                    events: {
                        click: function (map, event ) {
                            placeMarker( event.latLng );
                        },
                        rightclick: function(map, event) {
                            alert( "rightclick" );
                            alert( map + " " + event );
                        },
                        bounds_changed: function (map, event) {
                            var bounds = map.getBounds();
                            searchBox.setBounds( bounds );
                        }
                    }
                }
            } );

            googleMap = $( "#map-canvas" ).gmap3( "get" );

            //google.maps.event.addListener( googleMap, 'click', function ( event ) {
            //    placeMarker( event.latLng );
            //} );

            getLocation();

            google.maps.event.trigger( googleMap, 'resize' );

            $( "#content" ).height( $( window ).height() - 85 );
            $( window ).resize( function () {
                $( "#content" ).height( $( window ).height() - 85 );
            } );

            var showTagControlDiv = document.createElement( 'div' );
            var showTagButton = new ShowTagsButton( showTagControlDiv, googleMap, showTagsClicked );

            var searchBoxDiv = document.createElement( 'div' );
            var searchBoxControl = new SearchBox( searchBoxDiv );

            showTagControlDiv.index = 1;
            googleMap.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push( showTagControlDiv );

            searchBoxDiv.index = 1;
            googleMap.controls[google.maps.ControlPosition.TOP_LEFT].push( searchBoxDiv );

            var input = document.getElementById( "searchBox" );
            var searchBox = new google.maps.places.SearchBox( searchBoxControl );

            google.maps.event.addListener( searchBox, 'places_changed', function () {
                var places = searchBox.getPlaces();

                var bounds = new google.maps.LatLngBounds();
                for ( var i = 0, place; place = places[i]; i++ ) {
                    bounds.extend( place.geometry.location );
                }

                googleMap.fitBounds( bounds );
                googleMap.setZoom( 15 );
            } );
        }
        google.maps.event.addDomListener( window, 'load', initialize );

        function showTagsClicked() {
            loadPins();
        }
    </script>
}
